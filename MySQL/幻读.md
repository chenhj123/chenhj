创建表和记录

```sql
CREATE TABLE `tphantom` (
  `id` int(11) NOT NULL,
  `c` int(11) DEFAULT NULL,
  `d` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `c` (`c`)
) ENGINE=InnoDB;

insert into tphantom values(0,0,0),(5,5,5),
(10,10,10),(15,15,15),(20,20,20),(25,25,25);
```

### 幻读是什么？

我们先来假设一个场景

|                  session A                   |              session B              |              session C              |
| :------------------------------------------: | :---------------------------------: | :---------------------------------: |
|                    begin;                    |                                     |                                     |
| select * from tphantom where d=5 for update; |                                     |                                     |
|                                              | update tphantom set d=5 where id=0; |                                     |
| select * from tphantom where d=5 for update; |                                     |                                     |
|                                              |                                     | insert into tphantom values(1,1,5); |
| select * from tphantom where d=5 for update; |                                     |                                     |
|                   commit;                    |                                     |                                     |

我们可以发现，执行完 session A 的第一个 select 之后，session B 的 update 卡住了，session A 执行时应该加的是行锁，锁住 id=5 这一行，而 session B 执行的是 id=0，不相干，为什么还是锁住了呢，这是因为存在间隙锁，此时间隙锁锁住的是(0,5](5,10]

我们暂时先不讨论间隙锁，回到幻读，把 d=5 改成 d=11 就可以了